---
title: 数据库基本概念
date: 2022-11-25 17:54:34.115
updated: 2022-11-25 17:54:34.115
categories: 
- 阿里云ACA
tags: 
- DBMS
---

# 数据库基本概念

 (SQL，索引视图，事务，日志等)

## 数据库是什么

* 信息、数据与数据处理
* 应用程序和操作系统承上启下的作用
* 数据库（DB，Data Base）
* 数据库管理系统（DBMS，Data Base Management System）
* 数据库系统（DBS，Data Base System）

<img src="https://wrxinyue.oss-cn-hongkong.aliyuncs.com/img/image-20221125163819158.png" alt="image-20221125163819158" style="zoom:50%;" />

### 数据库与数据库实例的概念

**数据库：**
物理操作系统或其他形式文件类型的集合。在Oracle数据库是dbf、日志文件、密码文件等文件构成；在MySQL下数据库文件可以是frm、myd、myi、ibd结尾的文件。

**数据库实例：**
由数据库后台进程/线程以及一个共享内存区组成。Oracle是多进程程序；MySQL数据库是单进程多线程的程序，单进程多线程的特性决定MySQL是轻量级数据库（并发连接性能受限）。



## SQL基础概念

* Structured Query Language : 结构化查询语言,是一种特殊目的的编程语言,是**一种数据库查**
  **询和程序设计语言,用于存取数据以及查询、更新和管理关系数据库系统**。

* 结构化查询语言是**高级的非过程化编程语言,**允许用户在高层数据结构上工作。它不要求用户指
  定对数据的存放方法,也不需要用户了解具体的数据存放方式,所以具有完全不同底层结构的不
  同数据库系统可以使用相同的结构化查询语言作为数据输入与管理的接口。结构化查询语言语句
  可以嵌套,这使它具有极大的灵活性和强大的功能。

* SQL语言1974年由Boyce和Chamberlin提出,并首先在IBM公司研制的关系数据库系统SystemR
  上实现。由于它具有功能丰富、使用方便灵活、语言简洁易学等突出的优点,深受计算机工业界
  和计算机用户的欢迎。1980年10月,经美国国家标准局(ANSI)的数据库委员会X3H2批准,将
  SQL作为关系数据库语言的美国标准,同年公布了标准SQL,此后不久,国际标准化组织(ISO)也
  作出了同样的决定。



### SQL

**SQL 6大类：**

* 数据查询语言( DQL: Data Query Language) : 其语句,也称为“数据检索语句”, 用以从表中获得数据,确
  定数据怎样在应用程序给出。保留字SELECT是DQL (也是所有SQL )用得最多的动词,其他DQL常用的保留字
  有WHERE , ORDER BY , GROUP BY和HAVING。 这些DQL保留字常与其它类型的SQL语句一起使用。
* 数据操作语言( DML : Data Manipulation Language ) : 其语句包括动词INSERT、UPDATE和DELETE。 它们
  分别用于添加、修改和删除。
* 事务控制语言( TCL) : 它的语句能确保被DML语句影响的表的所有行及时得以更新。包括COMMIT (提交)命
  令、SAVEPOINT (保存点)命令、ROLLBACK (回滚)命令。
* 数据控制语言( DCL ) :它的语句通过GRANT或REVOKE实现权限控制,确定单个用户和用户组对数据库对象的
  访问。某些RDBMS可用GRANT或REVOKE控制对表单个列的访问。
* 数据定义语言(DDL) :其语句包括动词CREATE,ALTER和DROP。在数据库中创建新表或修改、删除表
  ( CREATE TABLE或DROP TABLE) ; 为表加入索引等。
* 指针控制语言( CCL) :它的语句,像DECLARE CURSOR , FETCH INTO和UPDATE WHERE CURRENT用于对
  一个或多个表单独行的操作。

**SQL的特点：**

* SQL风格统一
  SQL可以独立完成数据库生命周期中的全部活动,包括定义关系模式、录入数据、建立数据库、查询、更新、维护、
  数据库重构、数据库安全性控制等一系列操作 ,这就为数据库应用系统开发提供了良好的环境,在数据库投入运行
  后,还可根据需要随时逐步修改模式,且不影响数据库的运行,从而使系统具有良好的可扩充性。

* 高度非过程化
  非关系数据模型的数据操纵语言是面向过程的语言,用其完成用户请求时,必须指定存取路径。而用SQL进行数据
  操作,用户只需提出“做什么”, 而不必指明”怎么做”, 因此用户无须了解存取路径,存取路径的选择以及SQL语句的操作过程由系统自动完成。这不但大大减轻了用户负担,而且有利于提高数据独立性。

* 面向集合的操作方式
  SQL采用集合操作方式,不仅查找结果可以是元组的集合,而且一次插入、删除、更新操作的对象也可以是元组的集合

* 以同一种语法结构提供两种使用方式
  SQL既是自含式语言,又是嵌入式语言。作为自含式语言,它能够独立地用于联机交互的使用方式,用户可以在终端键盘上直接输入SQL命令对数据库进行操作。作为嵌入式语言, SQL语句能够嵌入到高级语言(如C、C#、 JAVA)程序中,供程序员设计程序时使用。而在两种不同的使用方式下, SQL的语法结构基本上是一致的。这种以统一的语法结构提供两种不同的操作方式,为用户提供了极大的灵活性与方便性。
* 语言简洁,易学易用
  SQL功能极强,但由于设计巧妙,语言十分简洁,完成数据定义、数据操纵、数据控制的核心功能只用了9个动词:
  CREATE、ALTER、 DROP、SELECT、 INSERT、 UPDATE、 DELETE、 GRANT、REVOKE。 且SQL语言语法简
  单，接近英语口语,因此容易学习,也容易使用。

### 索引

* 概念
  索引是对数据库表中一列或多列的值进行排序的一种结构 ,使用索引可快速访问数据库表中的特定信息。
  ![image-20221125171327836](https://wrxinyue.oss-cn-hongkong.aliyuncs.com/img/image-20221125171327836.png)
* 索弓|的创建和使用举例 :
  如果在查询时常用类似以下的语句: 
  `SELECT * FROM mytable WHERE category_id=1;`
  最直接的应对之道,是为category_ id建立一个简单的索引 :
  `CREATE INDEX mytable_categoryid ON mytable (category_id);`

**索引种类：**

* 唯一索引:UNIQUE
  例如在学生表中给学号字段创建唯一索引: `create unique index stusno on student (sno) ;`
  表明此索弓的每一个索引值只对应唯一的数据记录,对于单列唯一性索引,这保证单列不包含重复的值。
  对于多了唯一-性索引,保证多列值得组合不重复
* 主键索引primary key即唯一 +非空
  数据库关系图中在给表定义主键将自动创建主键索引,该索弓|要求主键中的每个值都唯一且非空。
* 聚集索引(又叫聚簇索引) : cluster
  聚簇索引并不是一种单独的索引类型,而是一种**数据存储方式**。在InnoDB中,表数据文件本身就是按
  B+Tree组织的一个索引结构,这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表
  的主键,因此InnoDB表数据文件本身就是主索引。

### 视图

* 视图是指计算机数据库中的视图,**是一个虚拟表**,其内容由查询定义。同真实的表一样,视图包含一系列带有名称的列和行数据。但是,视图并不在数据库中以存储的数据值集形式存在。行和列数据来自由定义视图的查询所引用的表,并且在引用视图时动态生成。

* 创建一个简单视图`V_ EMP_10` ,来显示部门10中的员工的编码、姓名和薪水: 

  ~~~sql
  CREATE VIEW v_emp_10
  AS
  SELECT emono,ename,sal,deptno
  FROM emp
  WHERE deptno = 10;
  ~~~

### 事物

**概念：**
在关系数据库中, 一个事务可以是一条SQL语句 , 一组SQL语句或整个程序。指访问并可能更新数据库中各的数据项的一个程序执行单元(unit)

**特性：**
*事务是恢复和并发控制的基本单位*。事务应该具有4个属性:原子性、一致性、隔离性、持久性。这四个属性通常称为ACID特性。

* 原子性( atomicity )。一个事务是一个不可分割的工作单位,事务中包括的操作要么都做,要么都不做。
* 一致性( consistency)。事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。
* 隔离性( isolation)。一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔的,并发执行的各个事务之间不能互相干扰。
* 持久性( durability )。持久性也称永久性( permanence) , 指一个事务一旦提交 ,它对数据库中数据的改变就应该是永久性
  的。接下来的其他操作或故障不应该对其有任何影响。

### 日志

* 现在的数据库系统( Oracel、DB2、 MS SQL、MySQL等)都支持多用户,所有的数据库系统(包括Exchange ) , 都是把数据先写到日志中,等某个时机(比如:确认commit )后再写到数据库记录中,日志是数据库最重要的数据之一
* 数据库都具有事务日志,用于记录所有事务以及每个事务对数据库所做的修改。事务日志是数据库的重要组件,如果系统出现故障,则可能需要使用事务日志将数据库恢复到一致状态。



**MySQL中有六种日志文件,分别是:**

* 重做日志(redolog)
* 回滚日志(undolog)
* 二进制日志( binlog )
* 错误日志( errorlog )
* 慢查询日志( slow query log )
* 一般查询日志( general log )
* 中继日志( relay log )

其中重做日志和回滚日志与事务操作息息相关,二进制日志也与事务操作有一定的关系,这三种日志,对理解MySQL中的事务操作有着重要的意义。



**MySQL重做日志**

* 作用:
  确保事务的持久性。redo日志记录事务执行后的状态,用来恢复未写入data file的已成功事务更新的数据。防止在发生故障的时间点,尚有脏页未写入磁盘,在重启MySQL服务的时候,根据redo log进行重做,从而达到事务的持久性这一特性。
* 内容:
  物理格式的日志,记录的是物理数据页面的修改的信息,其redo log是顺序写入redo log file的物理文件中去的。
* 什么时候产生:
  事务开始之后就产生redo log , redo log的落盘并不是随着事务的提交才写入的,而是在事务的执行过程中,便开
  始写入redo log文件中。
* 什么时候释放:
  当对应事务的脏页写入到磁盘之后, redo log的使命也就完成了,重做日志占用的空间就可以重用(被覆盖)。

**MySQL回滚日志**

* 作用:
  保证数据的原子性,保存了事务发生之前的数据的一个版本，可以用于回滚,同时可以提供多版本并发控制下的读( MVCC) , 也即非锁定读
* 内容:
  逻辑格式的日志,在执行undo的时候,仅仅是将数据从逻辑上恢复至事务之前的状态,而不是从物理页面上操作实现的,这一点是不同于redo log的。
* 什么时候产生:
  事务开始之前,将当前是的版本生成undo log , undo也会产生redo来保证undo log的可靠性
* 什么时候释放: 
  当事务提交之后, undo log并不能立马被删除,而是放入待清理的链表,由purge线程判断是否由其他事务在使用undo段中表的.上一个事务之前的版本信息,决定是否可以清理undo log的日志空间。

**MySQL二进制日志**

* 作用:
  用于复制,在主从复制中,从库利用主库上的binlog进行重播,实现主从同步。用于数据库的基于时间点的还原。
* 内容:
  逻辑格式的日志,可以简单认为就是执行过的事务中的sq|语句。不光SQL语句本身,而是包括了执行的SQL语句
  (增删改)反向的信息,也就意味着delete对应着delete本身和其反向的insert ; update对应着update执行前后
  的版本的信息; insert对应着delete和insert本身的信息。
* 什么时候产生:
  事务提交的时候, 一次性将事务中的SQL语句( 一个事物可能对应多个sql语句)按照一定的格式记录到binlog中。
  这里与redo log很明显的差异就是redo log并不一定是在事务提交的时候刷新到磁盘 , redo log是在事务开始之
  后就开始逐步写入磁盘。
  因此对于事务的提交,即便是较大的事务,提交( commit )都是很快的,但是在开启了binlog的情况下,对于较
  大事务的提交,可能会变得比较慢一些。
* 什么时候释放:
  binlog的默认是保持时间由参数expire_ logs_days配置,也就是说对于非活动的日志文件,在生成时间超过
  expire_ logs_days配置的天数之后,会被自动删除。