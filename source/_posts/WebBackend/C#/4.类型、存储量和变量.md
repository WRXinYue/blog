---
title: 4.类型、存储量和变量
date: 2022-07-24 23:03:58.0
updated: 2022-10-26 22:46:29.268
url: /archives/4-lei-xing--cun-chu-liang-he-bian-liang
categories: 
- C#/.NET
tags: 
- c#
- ./net
---

## C#程序是一组类型声明

C程序可以说是一组函数和数据类型，C++程序是一组函数和类，而C#程序是一组类型声明。

* C#程序或DLL的源代码是一组类型声明。
* 对于可执行程序，类型声明中必须有一个包含Main方法的类
* 命名空间是一种将相关的类型声明分组并命名的方法。因为程序是一组相关的类型声明，所以通常在你创建的命名空间内部声明程序类型。

~~~c#
namespace MyProgram		//创建新的命名空间
{
    DeclarationOfTypeA		//声明类型
    DeclarationOfTypeB
        
    class C				//声明类型
    {
        static void Mian()
        {
            ...
        }
    }
}
~~~

## 类型（数据类型）是一种模板

既然C#程序是一组类型声明，那么学习C#就是学习如何创建和使用类型。

类型由下面的元素定义：

* 名称；
* 用于保存数据成员的数据结构；
* 一些行为及约束条件。

![image-20220724204941396](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724204941396.png)

## 实例化类型

从某个类型模板创建实际的对象，称为实例化该类型。

* 通过实例化类型而创建的对象被称为类型的**对象**或者类型的**实例**
* 在C#程序中，每个数据项都是某种类型的实例。这些类型可以是语言自带的，可以是BCL或者其他库提供的，也可以是程序与定义的。

![image-20220724205821339](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724205821339.png)

## 数据成员和函数成员

像short、int和long这样的类型称为**简单类型**。这种类型只能存储一个数据项。

其他的类型可以存储多个数据项。比如**数组(array)**类型就可以存储多个同类型的数据项。这些数据项称为**数组**元素。可以通过数字来引用这些元素，这些数字被称为**索引**。

### 成员的类别

包含多个不同的数据类型的数据项，这些类型中的数据项个体称为**成员**，和数组不同，这些成员有独特的名称：

* 数据成员	保存了这个类的对象或整个类相关的数据。
* 函数成员    执行代码。函数成员定义类型的行为。

![image-20220724210808664](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724210808664.png)

## 预定义类型

C#提供了16种预定义类型，其中包括13种简单类型和3种非简单类型。

简单类型：

> * 11种数值类型（数据类型属于数值类型的超类）
>   * 不同长度的有符号和无符号整数类型。
>   * 浮点数类型float和double。
>   * decimal高精度小数类型，常用于货币计算。
> * Unicode字符类型char。
> * 布尔类型bool。

非简单类型：

> * string，Unicode字符数组。
> * object，其他类型的基类。
> * dynamic，使用动态语言编写的程序集时使用。

![image-20220724212150360](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724212150360.png)

### 预定类型的补充

所有预定类型都直接映射到底层的.NET类型。C#类型名称就是.NET类型的别名，所以使用.NET的类型名称也符合C#语法。

![image-20220724212526509](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724212526509.png)

![image-20220724212540755](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724212540755.png)

## 用户定义类型

有6种类型可以由用户自己创建：

> * 类类型（calss）；
> * 结构类型（struct）；
> * 数组类型（array）；
> * 枚举类型（enum）；
> * 委托类型（delegate）；
> * 接口类型（interface）；

类型通过类型声明创建，类型声明包含以下信息：

> * 要创建的类型的种类；
> * 新类型的名称；
> * 对类型中每个成员的声明（名称和规格），array和delegate类型除外，它们不含有命名成员。

![image-20220724213342909](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724213342909.png)

## 栈和堆

程序运行时，它的数据必须存储在内存中。一个数据项需要多大的内存、存储在什么地方，以及如何存储都依赖于该数据项的类型。

运行中的程序使用两个内存区域来存储数据：栈和堆

### 栈

栈是一个内存数组，是一个LIFO（Last-In First-Out，后进先出）的数据结构。栈存储几种类型的数据：

> * 某些类型变量的值；
> * 程序当前的执行环境；
> * 传递给方法的参数。

栈的特性：

> * 数据只能从栈的顶端插入和删除。
> * 把数据放到栈顶称为**入栈**（push）。
> * 从栈顶删除数据称为出栈（pop）。

![image-20220724214439691](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724214439691.png)

### 堆

堆是一块内存区域，在堆里可以分配大块的内存用于存储某种类型的数据对象。与栈不同，堆的内存能够以任意顺序存入和移除。

![image-20220724215301619](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724215301619.png)

堆里面的数据不能显式删除。CLR的自动垃圾收集器在判断出程序的代码将不会再访问某数据项时，会自动清除无主的堆对象。

![image-20220724215639141](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724215639141.png)

## 值类型和引用类型

数据项的类型定义了存储数据需要的内存大小及组成该类型的数据成员。类型还决定了对象在内存中的存储位置——栈或堆。

类型被分为两种：值类型和引用类型，这两种类型在内存中的存储方式不同：

> * 值类型只需要一段单独的内存，用于存储实际的数据。
> * 引用类型需要两端内存。
>   * 第一段存储实际的数据，它总是位于堆中。
>   * 第二段是引用，指向数据在堆中的存放位置。

![image-20220724220552136](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724220552136.png)

### 存储引用类型对象的成员

![image-20220724221100783](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724221100783.png)

### C#类型的分类

![image-20220724221306178](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724221306178.png)

## 变量

变量是一个名称，表示程序执行时存储在内存中的数据

![image-20220724221647942](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724221647942.png)

### 变量声明

变量使用前必须声明：

> * 给变量命名，并为它关联一种类型；
> * 让编译器为它分配一块内存。

实例：

~~~C
int var1;
//int为数据类型，var2为类型的值
~~~

4个变量的声明以及它们在栈中的位置

![image-20220724222035940](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724222035940.png)

1.变量初始化语句

除声明变量的名称和类型以外，声明还能把它的内存初始化为一个明确的值。

**变量初始化语句（variablie initializer）**由一个等号后面跟一个初始值组成，如：

~~~c#
int var2 = 17;
~~~

有些程序变量不初始化赋值会报错

![image-20220724222632442](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724222632442.png)

2.自动初始化

有些程序会自动初始化，没有自动初始化为默认值的变量在程序为它赋值之前包含未定义值。

![image-20220724222902859](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724222902859.png)

![image-20220724222919753](https://cdn.jsdelivr.net/gh/WRXinYue/PictureCDN/img/image-20220724222919753.png)

### 多变量声明

可以在单个声明语句中声明多个变量：

> * 多变量声明中的变量必须类型相同。
> * 变量名必须用逗号分隔，可以在变量名后包含初始化语句。

实例：

~~~c#
//声明一些变量，有的被初始化，优点未被初始化
int var3 = 7, var4, var5 = 3;
double var6, var7 = 6.53;

int var8, float var9;	//错误！多变量声明的变量类型必须相同
~~~

### 使用变量的值

变量名代表该变量保存的值，可以通过使用变量名来使用值。例如：

~~~c#
Console.WriteLine("{0}", var2);
Console.WriteLine("{var2}");
~~~

## 静态类型和dynamic关键字

每一个变量都包括变量类型。这样编译器在运行时可以确定需要的内存总量以及那些部分应该存在栈上，哪些部分应该在堆上。变量的类型在编译运行的时候不能被修改。这叫做**静态类型**。

不是所有的语言都是静态类型的，诸如InronPython和IronRuby之类的脚本语言时**动态类型**的。也就是说，变量的类型直到运行时才会被解析。由于它们是.NET语言，所以C#程序需要能够使用这些语言编写的程序集。问题是，程序集中的类型到运行时才会被解析，而C#又要引用这样的类型并且需要在编译的时候解析类型。

针对这个问题，C#语言设计者增加了dynamic关键字，代表一个特定的C#类型，它知道如何在运行时解析自身。

在编译时，编译器不会对dynamic类型的变量做类型检查。相反，他将与该变量及该变量的操作有关的所有信息打包。在运行时，会对这些信息进行检查，以确保它与变量所代表的实际类型一致。否则，将在运行时抛出异常。

## 可空类型

在某些情况下，特别是使用数据库的时候，你希望表示变量目前为保存有效的值。对于引用类型把变量设置为null即可。但定义值类型的变量时，不管它的内容是否含有有效的意义，其内存都会进行分配。

**可空类型**允许创建可以标记为有效或无效的值类型变量，这样就可以在使用它之前确定值的有效性。普通的值类型称作**非可空类型**。